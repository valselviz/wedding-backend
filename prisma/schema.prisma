generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Guest {
  id                Int                @id @default(autoincrement())
  full_name         String             @db.VarChar(100)
  guest_type        GuestType
  main_guest_id     Int?
  main_guest        Guest?             @relation("MainGuest", fields: [main_guest_id], references: [id], onUpdate: NoAction)
  side              Side?
  age_range         AgeRange           @default(ADULT)
  notes             String?
  status            Status             @default(INVITED)
  table_assignments TableAssignment[]
  group_members     GuestGroupMember[]
  other_guests      Guest[]            @relation("MainGuest")
}

model GuestGroup {
  id        Int                @id @default(autoincrement())
  name      String             @db.VarChar(100)
  category  String?            @db.VarChar(50)
  members   GuestGroupMember[]
}

model GuestGroupMember {
  id       Int        @id @default(autoincrement())
  guest    Guest      @relation(fields: [guest_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  guest_id Int
  group    GuestGroup @relation(fields: [group_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  group_id Int
}

model Table {
  id          Int               @id @default(autoincrement())
  name        String            @db.VarChar(50)
  shape       Shape?
  seats       Int
  category    String?           @db.VarChar(50)
  assignments TableAssignment[]
}

model TableAssignment {
  id          Int   @id @default(autoincrement())
  table       Table @relation(fields: [table_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  table_id    Int
  guest       Guest @relation(fields: [guest_id], references: [id], onDelete: Cascade, onUpdate: NoAction)
  guest_id    Int
  seat_number Int?
}

enum GuestType {
  MAIN_GUEST
  PLUS_ONE
  BRIDE
  GROOM
}

enum Side {
  BRIDE
  GROOM
}

enum AgeRange {
  ADULT
  CHILD
  BABY
}

enum Status {
  INVITED
  CONFIRMED
  DECLINED
}

enum Shape {
  redonda
  rectangular
}
